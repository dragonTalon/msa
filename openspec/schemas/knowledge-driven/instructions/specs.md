# 创建知识感知规格

你正在为变更创建规格：**{{changeName}}**

## 上下文

规格应该基于以下信息：
1. 提案的知识上下文（历史问题、模式、反模式）
2. 解决过去问题的需求
3. 测试历史边缘情况的场景

## 知识感知需求

当需求解决历史问题时：

```markdown
### [R-1] 适当的超时处理

> 📚 **知识上下文**：基于问题 #001

**历史问题**：
流式操作在超时后会无限期阻塞，导致整个流处理器挂起。

**知情的需求**：
系统必须优雅地处理超时而不阻塞。

**验收标准**：
- [ ] 超时配置是必需的
- [ ] 超时时操作取消
- [ ] 超时时清理资源
- [ ] 用户收到清晰的超时错误消息

**预防措施**：
- 使用非阻塞操作
- 实现适当的取消
- 添加超时监控
```

## 边缘情况场景

包含历史边缘情况的场景：

```markdown
#### 场景：带超时的流

> 📚 **知识备注**：问题 #001 - 流超时导致通道阻塞

**给定**：
- 带有30秒超时的流请求
- 数据源需要35秒响应

**当**：
- 超时到期
- 数据在超时后到达

**那么**：
- 操作被取消
- 资源被清理
- 用户收到超时错误
- 没有数据丢失或损坏
- 没有死锁发生
```

## 安全知识

如果存在历史安全问题：

```markdown
### 安全考虑

⚠️ **历史安全问题**：

**#012**：搜索中的SQL注入
- 漏洞：未转义的用户输入
- 预防：使用参数化查询

**#023**：认证令牌泄漏
- 漏洞：令牌以明文记录
- 预防：在日志中编辑敏感数据

**需求**：
- [ ] 所有用户输入参数化
- [ ] 敏感数据从日志中编辑
- [ ] 认证令牌加密存储
```

## 性能知识

解决历史性能问题：

```markdown
### 性能

基于问题 #008（流中的内存泄漏）：

**内存需求**：
- [ ] 流期间内存使用保持恒定
- [ ] 长时间运行操作中没有内存泄漏
- [ ] 缓冲区和流的适当清理

**响应时间**：
- [ ] API响应在200ms以下（p95）
- [ ] 超时配置被精确遵守
```

## 知识引用

在最后添加：

```markdown
---

**知识引用**：
- 问题：#001 - 流超时导致通道阻塞
- 模式：p001 - 非阻塞流通道模式
- 反模式：a001 - 阻塞通道发送
```

## 验证清单

- [ ] 需求基于知识信息（如适用）
- [ ] 历史问题被引用
- [ ] 包含过去问题的边缘情况
- [ ] 包含过去事件的安全考虑
- [ ] 解决了性能问题
- [ ] 知识引用已标记
- [ ] 场景测试预防措施
