# 规格：web-search

> **Capability**: 网页搜索
> **Purpose**: 系统必须提供 Agent 执行互联网搜索的能力，以获取实时的网络信息作为分析参考。

## 需求：执行网页搜索

系统必须提供 Agent 执行互联网搜索的能力，以获取实时的网络信息作为分析参考。

#### 场景：Agent 执行基本搜索

- **当** Agent 需要获取关于某个主题的最新信息
- **并且** 调用 `web_search` 工具并传入查询关键词
- **那么** 系统必须在 5 秒内返回至少 10 个相关搜索结果
- **并且** 每个结果必须包含：标题、URL、摘要、来源域名

#### 场景：处理中文搜索查询

- **当** Agent 使用中文关键词进行搜索
- **那么** 系统必须正确编码查询参数
- **并且** 返回中文相关的搜索结果

#### 场景：搜索引擎不可达

- **当** 搜索引擎无法访问（网络问题、超时、或被反爬虫拦截）
- **那么** 系统必须返回清晰的错误信息给 Agent
- **并且** 不应导致整个 Agent 会话崩溃

---

## 需求：搜索结果结构化

搜索结果必须以结构化的格式返回，便于 Agent 理解和处理。

#### 场景：标准搜索结果格式

- **当** 搜索成功完成
- **那么** 返回结果必须是 JSON 格式
- **并且** 包含以下字段：
  - `query`: 原始查询词
  - `results`: 结果数组，每个元素包含：
    - `title`: 网页标题
    - `url`: 完整 URL
    - `snippet`: 搜索引擎提供的摘要
    - `source`: 来源域名（从 URL 提取）

#### 场景：结果数量固定

- **当** 执行搜索请求
- **那么** 默认返回 10 条结果
- **并且** Agent 不需要指定结果数量

---

## 需求：Google 搜索引擎支持

系统必须支持使用 Google 作为默认搜索引擎。

#### 场景：使用 Google 搜索

- **当** Agent 执行搜索请求
- **那么** 系统必须使用 Google 搜索引擎
- **并且** 能够处理 Google 搜索结果页的 HTML 结构
- **并且** 提取标题、链接、摘要等关键信息

#### 场景：处理 Google 反爬虫

- **当** Google 检测到爬虫行为并返回 CAPTCHA 或验证页面
- **那么** 系统必须识别这种情况
- **并且** 返回明确的错误信息，说明需要人工处理
- **并且** 不应无限重试

---

## 需求：可扩展的搜索引擎接口

搜索引擎实现必须与工具层解耦，便于未来添加其他搜索引擎。

#### 场景：搜索引擎接口定义

- **当** 系统设计搜索引擎组件
- **那么** 必须定义 `SearchEngine` 接口
- **并且** 该接口必须包含 `Search(query string, numResults int) ([]SearchResultItem, error)` 方法

#### 场景：添加新搜索引擎

- **当** 未来需要添加 Bing 或百度等搜索引擎
- **那么** 开发者只需实现 `SearchEngine` 接口
- **并且** 不需要修改工具层代码
- **并且** 可以通过配置切换默认引擎

---

## 需求：浏览器实例管理

系统必须管理浏览器生命周期，平衡性能和资源占用。

#### 场景：首次搜索启动浏览器

- **当** Agent 第一次执行搜索
- **那么** 系统必须启动 Chrome headless 实例
- **并且** 启动时间不应超过 3 秒

#### 场景：复用浏览器实例

- **当** 在同一会话中执行多次搜索
- **那么** 系统必须复用已启动的浏览器实例
- **并且** 后续搜索响应时间应小于 2 秒

#### 场景：清理浏览器资源

- **当** Agent 会话结束或程序退出
- **那么** 系统必须正确关闭浏览器实例
- **并且** 释放相关资源（内存、进程）

---

## 需求：错误处理和重试

系统必须优雅地处理各种错误情况，并提供清晰的反馈。

#### 场景：网络超时

- **当** 搜索请求超时（超过 5 秒）
- **那么** 系统必须取消请求并返回超时错误
- **并且** 错误信息必须包含超时时间和原因

#### 场景：无效的查询参数

- **当** Agent 传入空字符串或只有空格的查询词
- **那么** 系统必须返回参数错误
- **并且** 不应执行实际的搜索请求

#### 场景：Chrome 未安装

- **当** 用户系统中没有安装 Chrome 或 Chromium
- **那么** 系统必须在启动时检测到
- **并且** 返回友好的错误信息，指导用户安装浏览器
